{"version":3,"file":"LinuxTargetHelper.js","sourceRoot":"","sources":["../../src/targets/LinuxTargetHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import { isEmptyOrSpaces, log } from \"builder-util\"\nimport { outputFile } from \"fs-extra-p\"\nimport { Lazy } from \"lazy-val\"\nimport * as path from \"path\"\nimport { LinuxTargetSpecificOptions } from \"..\"\nimport { LinuxPackager } from \"../linuxPackager\"\nimport { IconInfo } from \"../platformPackager\"\nimport { getTemplatePath } from \"../util/pathManager\"\n\nexport const installPrefix = \"/opt\"\n\nexport class LinuxTargetHelper {\n  private readonly iconPromise = new Lazy(() => this.computeDesktopIcons())\n\n  maxIconPath: string | null = null\n\n  constructor(private packager: LinuxPackager) {\n  }\n\n  get icons(): Promise<Array<IconInfo>> {\n    return this.iconPromise.value\n  }\n\n  // must be name without spaces and other special characters, but not product name used\n  private async computeDesktopIcons(): Promise<Array<IconInfo>> {\n    const packager = this.packager\n    const iconDir = packager.platformSpecificBuildOptions.icon\n    const sources = [iconDir == null ? \"icons\" : iconDir]\n\n    const commonConfiguration = packager.config\n    let icnsPath = (commonConfiguration.mac || {}).icon || commonConfiguration.icon\n    if (icnsPath != null) {\n      if (!icnsPath.endsWith(\".icns\")) {\n        icnsPath += \".icns\"\n      }\n      sources.push(icnsPath)\n    }\n\n    sources.push(\"icon.icns\")\n\n    sources.push(path.join(getTemplatePath(\"linux\"), \"electron-icons\"))\n\n    const result = await packager.resolveIcon(sources, \"set\")\n    this.maxIconPath = result[result.length - 1].file\n    return result\n  }\n\n  getDescription(options: LinuxTargetSpecificOptions) {\n    return options.description || this.packager.appInfo.description\n  }\n\n  async writeDesktopEntry(targetSpecificOptions: LinuxTargetSpecificOptions, exec?: string, destination?: string | null, extra?: { [key: string]: string; }): Promise<string> {\n    const data = await this.computeDesktopEntry(targetSpecificOptions, exec, extra)\n    const file = destination || await this.packager.getTempFile(`${this.packager.appInfo.productFilename}.desktop`)\n    await outputFile(file, data)\n    return file\n  }\n\n  async computeDesktopEntry(targetSpecificOptions: LinuxTargetSpecificOptions, exec?: string, extra?: { [key: string]: string; }): Promise<string> {\n    if (exec != null && exec.length === 0) {\n      throw new Error(\"Specified exec is empty\")\n    }\n\n    const appInfo = this.packager.appInfo\n\n    const productFilename = appInfo.productFilename\n\n    const desktopMeta: any = {\n      Name: appInfo.productName,\n      Comment: this.getDescription(targetSpecificOptions),\n      Exec: exec == null ? `\"${installPrefix}/${productFilename}/${this.packager.executableName}\" %U` : exec,\n      Terminal: \"false\",\n      Type: \"Application\",\n      Icon: this.packager.executableName,\n      ...extra,\n      ...targetSpecificOptions.desktop,\n    }\n\n    let category = targetSpecificOptions.category\n    if (isEmptyOrSpaces(category)) {\n      const macCategory = (this.packager.config.mac || {}).category\n      if (macCategory != null) {\n        category = macToLinuxCategory[macCategory]\n      }\n\n      if (category == null) {\n        // https://github.com/develar/onshape-desktop-shell/issues/48\n        if (macCategory != null) {\n          log.warn({macCategory}, \"cannot map macOS category to Linux. If possible mapping is known for you, please file issue to add it.\")\n        }\n        log.warn({\n          reason: \"linux.category is not set and cannot map from macOS\",\n          docs: \"https://electron.build/configuration/configuration#LinuxBuildOptions-category\",\n        }, \"application Linux category is set to default \\\"Utility\\\"\")\n        category = \"Utility\"\n      }\n    }\n    desktopMeta.Categories = `${category}${category.endsWith(\";\") ? \"\" : \";\"}`\n\n    let data = `[Desktop Entry]`\n    for (const name of Object.keys(desktopMeta)) {\n      const value = desktopMeta[name]\n      data += `\\n${name}=${value}`\n    }\n    data += \"\\n\"\n    return data\n  }\n}\n\nconst macToLinuxCategory: any = {\n  \"public.app-category.graphics-design\": \"Graphics\",\n  \"public.app-category.developer-tools\": \"Development\",\n  \"public.app-category.education\": \"Education\",\n  \"public.app-category.games\": \"Game\",\n  \"public.app-category.video\": \"Video;AudioVideo\",\n  \"public.app-category.utilities\": \"Utility\",\n  \"public.app-category.social-networking\": \"Chat\",\n  \"public.app-category.finance\": \"Finance\",\n}"]}
