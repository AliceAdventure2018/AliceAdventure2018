{"version":3,"file":"NsisTarget.js","sourceRoot":"","sources":["../../../src/targets/nsis/NsisTarget.ts"],"names":[],"mappings":"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","sourcesContent":["import BluebirdPromise from \"bluebird-lst\"\nimport { Arch, asArray, AsyncTaskManager, execWine, getPlatformIconFileName, InvalidConfigurationError, log, spawnAndWrite, use } from \"builder-util\"\nimport { PackageFileInfo, UUID } from \"builder-util-runtime\"\nimport { getBinFromGithub } from \"builder-util/out/binDownload\"\nimport { statOrNull, walk } from \"builder-util/out/fs\"\nimport { hashFile } from \"builder-util/out/hash\"\nimport _debug from \"debug\"\nimport { readFile, stat, unlink } from \"fs-extra-p\"\nimport { Lazy } from \"lazy-val\"\nimport * as path from \"path\"\nimport { Target } from \"../../core\"\nimport { getEffectiveOptions } from \"../../options/CommonWindowsInstallerConfiguration\"\nimport { isSafeGithubName, normalizeExt } from \"../../platformPackager\"\nimport { time } from \"../../util/timer\"\nimport { WinPackager } from \"../../winPackager\"\nimport { archive, ArchiveOptions } from \"../archive\"\nimport { appendBlockmap, configureDifferentialAwareArchiveOptions, createBlockmap, createNsisWebDifferentialUpdateInfo } from \"../differentialUpdateInfoBuilder\"\nimport { addCustomMessageFileInclude, createAddLangsMacro, LangConfigurator } from \"./nsisLang\"\nimport { computeLicensePage } from \"./nsisLicense\"\nimport { NsisOptions, PortableOptions } from \"./nsisOptions\"\nimport { NsisScriptGenerator } from \"./nsisScriptGenerator\"\nimport { AppPackageHelper, NSIS_PATH, nsisTemplatesDir } from \"./nsisUtil\"\n\nconst debug = _debug(\"electron-builder:nsis\")\n\n// noinspection SpellCheckingInspection\nconst ELECTRON_BUILDER_NS_UUID = UUID.parse(\"50e065bc-3134-11e6-9bab-38c9862bdaf3\")\n\n// noinspection SpellCheckingInspection\nconst nsisResourcePathPromise = new Lazy(() => getBinFromGithub(\"nsis-resources\", \"3.3.0\", \"4okc98BD0v9xDcSjhPVhAkBMqos+FvD/5/H72fTTIwoHTuWd2WdD7r+1j72hxd+ZXxq1y3FRW0x6Z3jR0VfpMw==\"))\n\nconst USE_NSIS_BUILT_IN_COMPRESSOR = false\n\nexport class NsisTarget extends Target {\n  readonly options: NsisOptions\n\n  /** @private */\n  readonly archs: Map<Arch, string> = new Map()\n\n  constructor(protected readonly packager: WinPackager, readonly outDir: string, targetName: string, protected readonly packageHelper: AppPackageHelper) {\n    super(targetName)\n\n    this.packageHelper.refCount++\n\n    this.options = targetName === \"portable\" ? Object.create(null) : {\n      ...this.packager.config.nsis,\n      preCompressedFileExtensions: [\".avi\", \".mov\", \".m4v\", \".mp4\", \".m4p\", \".qt\", \".mkv\", \".webm\", \".vmdk\"],\n    }\n\n    if (targetName !== \"nsis\") {\n      Object.assign(this.options, (this.packager.config as any)[targetName === \"nsis-web\" ? \"nsisWeb\" : targetName])\n    }\n\n    const deps = packager.info.metadata.dependencies\n    if (deps != null && deps[\"electron-squirrel-startup\"] != null) {\n      log.warn('\"electron-squirrel-startup\" dependency is not required for NSIS')\n    }\n  }\n\n  async build(appOutDir: string, arch: Arch) {\n    this.archs.set(arch, appOutDir)\n  }\n\n  get isBuildDifferentialAware() {\n    return !this.isPortable && this.options.differentialPackage !== false\n  }\n\n  private getPreCompressedFileExtensions(): Array<string> | null {\n    const result = this.isWebInstaller ? null : this.options.preCompressedFileExtensions\n    return result == null ? null : asArray(result).map(it => it.startsWith(\".\") ? it : `.${it}`)\n  }\n\n  /** @private */\n  async buildAppPackage(appOutDir: string, arch: Arch): Promise<PackageFileInfo> {\n    const options = this.options\n    const packager = this.packager\n\n    const isBuildDifferentialAware = this.isBuildDifferentialAware\n    const format = !isBuildDifferentialAware && options.useZip ? \"zip\" : \"7z\"\n    const archiveFile = path.join(this.outDir, `${packager.appInfo.sanitizedName}-${packager.appInfo.version}-${Arch[arch]}.nsis.${format}`)\n    const preCompressedFileExtensions = this.getPreCompressedFileExtensions()\n    const archiveOptions: ArchiveOptions = {\n      withoutDir: true,\n      compression: packager.compression,\n      excluded: preCompressedFileExtensions == null ? null : preCompressedFileExtensions.map(it => `*${it}`)\n    }\n\n    const timer = time(`nsis package, ${Arch[arch]}`)\n    await archive(format, archiveFile, appOutDir, isBuildDifferentialAware ? configureDifferentialAwareArchiveOptions(archiveOptions) : archiveOptions)\n    timer.end()\n\n    if (isBuildDifferentialAware && this.isWebInstaller) {\n      const data = await appendBlockmap(archiveFile)\n      return {\n        ...data,\n        size: data.size!!,\n        path: archiveFile,\n      }\n    }\n    else {\n      return await createPackageFileInfo(archiveFile)\n    }\n  }\n\n  async finishBuild(): Promise<any> {\n    try {\n      await this.buildInstaller()\n    }\n    finally {\n      await this.packageHelper.finishBuild()\n    }\n  }\n\n  protected get installerFilenamePattern(): string {\n    // tslint:disable:no-invalid-template-strings\n    return \"${productName} \" + (this.isPortable ? \"\" : \"Setup \") + \"${version}.${ext}\"\n  }\n\n  private get isPortable() {\n    return this.name === \"portable\"\n  }\n\n  private async buildInstaller(): Promise<any> {\n    const packager = this.packager\n    const appInfo = packager.appInfo\n    const options = this.options\n    const installerFilename = packager.expandArtifactNamePattern(options, \"exe\", null, this.installerFilenamePattern)\n    const oneClick = options.oneClick !== false\n    const installerPath = path.join(this.outDir, installerFilename)\n\n    const logFields: any = {\n      target: this.name,\n      file: log.filePath(installerPath),\n      archs: Array.from(this.archs.keys()).map(it => Arch[it]).join(\", \"),\n    }\n    if (!this.isPortable) {\n      logFields.oneClick = oneClick\n    }\n    log.info(logFields, \"building\")\n\n    const guid = options.guid || UUID.v5(appInfo.id, ELECTRON_BUILDER_NS_UUID)\n    const defines: any = {\n      APP_ID: appInfo.id,\n      APP_GUID: guid,\n      PRODUCT_NAME: appInfo.productName,\n      PRODUCT_FILENAME: appInfo.productFilename,\n      APP_FILENAME: (!oneClick || options.perMachine === true) && /^[-_+0-9a-zA-Z .]+$/.test(appInfo.productFilename) ? appInfo.productFilename : appInfo.sanitizedName,\n      APP_DESCRIPTION: appInfo.description,\n      VERSION: appInfo.version,\n\n      PROJECT_DIR: packager.projectDir,\n      BUILD_RESOURCES_DIR: packager.info.buildResourcesDir,\n    }\n\n    const commands: any = {\n      OutFile: `\"${installerPath}\"`,\n      VIProductVersion: appInfo.versionInWeirdWindowsForm,\n      VIAddVersionKey: this.computeVersionKey(),\n      Unicode: this.isUnicodeEnabled,\n    }\n\n    const isPortable = this.isPortable\n    const iconPath = (isPortable ? null : await packager.getResource(options.installerIcon, \"installerIcon.ico\")) || await packager.getIconPath()\n    if (iconPath != null) {\n      if (isPortable) {\n        commands.Icon = `\"${iconPath}\"`\n      }\n      else {\n        defines.MUI_ICON = iconPath\n        defines.MUI_UNICON = iconPath\n      }\n    }\n\n    const packageFiles: { [arch: string]: PackageFileInfo } = {}\n    if (this.isPortable && options.useZip) {\n      for (const [arch, dir] of this.archs.entries()) {\n        defines[arch === Arch.x64 ? \"APP_DIR_64\" : \"APP_DIR_32\"] = dir\n      }\n    }\n    else if (USE_NSIS_BUILT_IN_COMPRESSOR && this.archs.size === 1) {\n      defines.APP_BUILD_DIR = this.archs.get(this.archs.keys().next().value)\n    }\n    else {\n      await BluebirdPromise.map(this.archs.keys(), async arch => {\n        const fileInfo = await this.packageHelper.packArch(arch, this)\n        const file = fileInfo.path\n        const defineKey = arch === Arch.x64 ? \"APP_64\" : \"APP_32\"\n        defines[defineKey] = file\n        defines[`${defineKey}_NAME`] = path.basename(file)\n        // nsis expect a hexadecimal string\n        defines[`${defineKey}_HASH`] = Buffer.from(fileInfo.sha512, \"base64\").toString(\"hex\").toUpperCase()\n\n        if (this.isWebInstaller) {\n          packager.dispatchArtifactCreated(file, this, arch)\n          packageFiles[Arch[arch]] = fileInfo\n        }\n      })\n    }\n\n    this.configureDefinesForAllTypeOfInstaller(defines)\n    if (isPortable) {\n      defines.REQUEST_EXECUTION_LEVEL = (options as PortableOptions).requestExecutionLevel || \"user\"\n    }\n    else {\n      await this.configureDefines(oneClick, defines)\n    }\n\n    if (packager.compression === \"store\") {\n      commands.SetCompress = \"off\"\n    }\n    else {\n      // difference - 33.540 vs 33.601, only 61 KB (but zip is faster to decompress)\n      // do not use /SOLID - \"With solid compression, files are uncompressed to temporary file before they are copied to their final destination\",\n      // it is not good for portable installer (where built-in NSIS compression is used). http://forums.winamp.com/showpost.php?p=2982902&postcount=6\n      commands.SetCompressor = \"zlib\"\n      if (!this.isWebInstaller) {\n        defines.COMPRESS = \"auto\"\n      }\n    }\n\n    debug(defines)\n    debug(commands)\n\n    if (packager.packagerOptions.effectiveOptionComputed != null && await packager.packagerOptions.effectiveOptionComputed([defines, commands])) {\n      return\n    }\n\n    const sharedHeader = await this.computeCommonInstallerScriptHeader()\n    const script = isPortable ? await readFile(path.join(nsisTemplatesDir, \"portable.nsi\"), \"utf8\") : await this.computeScriptAndSignUninstaller(defines, commands, installerPath, sharedHeader)\n    await this.executeMakensis(defines, commands, sharedHeader + await this.computeFinalScript(script, true))\n    await Promise.all<any>([packager.sign(installerPath), defines.UNINSTALLER_OUT_FILE == null ? Promise.resolve() : unlink(defines.UNINSTALLER_OUT_FILE)])\n\n    const safeArtifactName = isSafeGithubName(installerFilename) ? installerFilename : this.generateGitHubInstallerName()\n\n    let updateInfo: any\n    if (this.isWebInstaller) {\n      updateInfo = createNsisWebDifferentialUpdateInfo(installerPath, packageFiles)\n    }\n    else if (this.isBuildDifferentialAware) {\n      updateInfo = await createBlockmap(installerPath, this, packager, safeArtifactName)\n    }\n\n    packager.info.dispatchArtifactCreated({\n      file: installerPath,\n      updateInfo,\n      target: this,\n      packager,\n      arch: this.archs.size === 1 ? this.archs.keys().next().value : null,\n      safeArtifactName,\n      isWriteUpdateInfo: !this.isPortable,\n    })\n  }\n\n  protected generateGitHubInstallerName() {\n    const appInfo = this.packager.appInfo\n    const classifier = appInfo.name.toLowerCase() === appInfo.name ? \"setup-\" : \"Setup-\"\n    return `${appInfo.name}-${this.isPortable ? \"\" : classifier}${appInfo.version}.exe`\n  }\n\n  private get isUnicodeEnabled() {\n    return this.options.unicode !== false\n  }\n\n  get isWebInstaller(): boolean {\n    return false\n  }\n\n  private async computeScriptAndSignUninstaller(defines: any, commands: any, installerPath: string, sharedHeader: string) {\n    const packager = this.packager\n    const customScriptPath = await packager.getResource(this.options.script, \"installer.nsi\")\n    const script = await readFile(customScriptPath || path.join(nsisTemplatesDir, \"installer.nsi\"), \"utf8\")\n\n    if (customScriptPath != null) {\n      log.info({reason: \"custom NSIS script is used\"}, \"uninstaller is not signed by electron-builder\")\n      return script\n    }\n\n    // https://github.com/electron-userland/electron-builder/issues/2103\n    // it is more safe and reliable to write uninstaller to our out dir\n    const uninstallerPath = path.join(this.outDir, `.__uninstaller-${this.name}-${this.packager.appInfo.sanitizedName}.exe`)\n    const isWin = process.platform === \"win32\"\n    defines.BUILD_UNINSTALLER = null\n    defines.UNINSTALLER_OUT_FILE = isWin ? uninstallerPath : path.win32.join(\"Z:\", uninstallerPath)\n    await this.executeMakensis(defines, commands, sharedHeader + await this.computeFinalScript(script, false))\n    await execWine(installerPath, [])\n    await packager.sign(uninstallerPath, \"  Signing NSIS uninstaller\")\n\n    delete defines.BUILD_UNINSTALLER\n    // platform-specific path, not wine\n    defines.UNINSTALLER_OUT_FILE = uninstallerPath\n    return script\n  }\n\n  private computeVersionKey() {\n    // Error: invalid VIProductVersion format, should be X.X.X.X\n    // so, we must strip beta\n    const localeId = this.options.language || \"1033\"\n    const appInfo = this.packager.appInfo\n    const versionKey = [\n      `/LANG=${localeId} ProductName \"${appInfo.productName}\"`,\n      `/LANG=${localeId} ProductVersion \"${appInfo.version}\"`,\n      `/LANG=${localeId} LegalCopyright \"${appInfo.copyright}\"`,\n      `/LANG=${localeId} FileDescription \"${appInfo.description}\"`,\n      `/LANG=${localeId} FileVersion \"${appInfo.buildVersion}\"`,\n    ]\n    use(this.packager.platformSpecificBuildOptions.legalTrademarks, it => versionKey.push(`/LANG=${localeId} LegalTrademarks \"${it}\"`))\n    use(appInfo.companyName, it => versionKey.push(`/LANG=${localeId} CompanyName \"${it}\"`))\n    return versionKey\n  }\n\n  protected configureDefines(oneClick: boolean, defines: any): Promise<any> {\n    const packager = this.packager\n    const options = this.options\n\n    const asyncTaskManager = new AsyncTaskManager(packager.info.cancellationToken)\n\n    if (oneClick) {\n      defines.ONE_CLICK = null\n\n      if (options.runAfterFinish !== false) {\n        defines.RUN_AFTER_FINISH = null\n      }\n\n      asyncTaskManager.add(async () => {\n        const installerHeaderIcon = await packager.getResource(options.installerHeaderIcon, \"installerHeaderIcon.ico\")\n        if (installerHeaderIcon != null) {\n          defines.HEADER_ICO = installerHeaderIcon\n        }\n      })\n    }\n    else {\n      asyncTaskManager.add(async () => {\n        const installerHeader = await packager.getResource(options.installerHeader, \"installerHeader.bmp\")\n        if (installerHeader != null) {\n          defines.MUI_HEADERIMAGE = null\n          defines.MUI_HEADERIMAGE_RIGHT = null\n          defines.MUI_HEADERIMAGE_BITMAP = installerHeader\n        }\n      })\n\n      asyncTaskManager.add(async () => {\n        const bitmap = (await packager.getResource(options.installerSidebar, \"installerSidebar.bmp\")) || \"${NSISDIR}\\\\Contrib\\\\Graphics\\\\Wizard\\\\nsis3-metro.bmp\"\n        defines.MUI_WELCOMEFINISHPAGE_BITMAP = bitmap\n        defines.MUI_UNWELCOMEFINISHPAGE_BITMAP = (await packager.getResource(options.uninstallerSidebar, \"uninstallerSidebar.bmp\")) || bitmap\n      })\n\n      if (options.allowElevation !== false) {\n        defines.MULTIUSER_INSTALLMODE_ALLOW_ELEVATION = null\n      }\n    }\n\n    if (options.perMachine === true) {\n      defines.INSTALL_MODE_PER_ALL_USERS = null\n    }\n\n    if (!oneClick || options.perMachine === true) {\n      defines.INSTALL_MODE_PER_ALL_USERS_REQUIRED = null\n    }\n\n    if (options.allowToChangeInstallationDirectory) {\n      if (oneClick) {\n        throw new InvalidConfigurationError(\"allowToChangeInstallationDirectory makes sense only for assisted installer (please set oneClick to false)\")\n      }\n      defines.allowToChangeInstallationDirectory = null\n    }\n\n    const commonOptions = getEffectiveOptions(options, packager)\n\n    if (commonOptions.menuCategory != null) {\n      defines.MENU_FILENAME = commonOptions.menuCategory\n    }\n\n    defines.SHORTCUT_NAME = commonOptions.shortcutName\n\n    if (options.deleteAppDataOnUninstall) {\n      defines.DELETE_APP_DATA_ON_UNINSTALL = null\n    }\n\n    asyncTaskManager.add(async () => {\n      const uninstallerIcon = await packager.getResource(options.uninstallerIcon, \"uninstallerIcon.ico\")\n      if (uninstallerIcon != null) {\n        // we don't need to copy MUI_UNICON (defaults to app icon), so, we have 2 defines\n        defines.UNINSTALLER_ICON = uninstallerIcon\n        defines.MUI_UNICON = uninstallerIcon\n      }\n    })\n\n    defines.UNINSTALL_DISPLAY_NAME = packager.expandMacro(options.uninstallDisplayName || \"${productName} ${version}\", null, {}, false)\n    if (!commonOptions.isCreateDesktopShortcut) {\n      defines.DO_NOT_CREATE_DESKTOP_SHORTCUT = null\n    }\n    if (!commonOptions.isCreateStartMenuShortcut) {\n      defines.DO_NOT_CREATE_START_MENU_SHORTCUT = null\n    }\n\n    if (options.displayLanguageSelector === true) {\n      defines.DISPLAY_LANG_SELECTOR = null\n    }\n\n    return asyncTaskManager.awaitTasks()\n  }\n\n  private configureDefinesForAllTypeOfInstaller(defines: any) {\n    const appInfo = this.packager.appInfo\n    const companyName = appInfo.companyName\n    if (companyName != null) {\n      defines.COMPANY_NAME = companyName\n    }\n\n    // electron uses product file name as app data, define it as well to remove on uninstall\n    if (defines.APP_FILENAME !== appInfo.productFilename) {\n      defines.APP_PRODUCT_FILENAME = appInfo.productFilename\n    }\n    defines.APP_INSTALLER_STORE_FILE = `${appInfo.productFilename}\\\\installer.exe`\n\n    const options = this.options\n\n    if (!this.isWebInstaller && defines.APP_BUILD_DIR == null) {\n      if (options.useZip) {\n        defines.ZIP_COMPRESSION = null\n      }\n\n      defines.COMPRESSION_METHOD = options.useZip ? \"zip\" : \"7z\"\n    }\n  }\n\n  private async executeMakensis(defines: any, commands: any, script: string) {\n    const args: Array<string> = (this.options.warningsAsErrors === false) ? [] : [\"-WX\"]\n    for (const name of Object.keys(defines)) {\n      const value = defines[name]\n      if (value == null) {\n        args.push(`-D${name}`)\n      }\n      else {\n        args.push(`-D${name}=${value}`)\n      }\n    }\n\n    for (const name of Object.keys(commands)) {\n      const value = commands[name]\n      if (Array.isArray(value)) {\n        for (const c of value) {\n          args.push(`-X${name} ${c}`)\n        }\n      }\n      else {\n        args.push(`-X${name} ${value}`)\n      }\n    }\n\n    args.push(\"-\")\n\n    if (this.packager.debugLogger.enabled) {\n      this.packager.debugLogger.add(\"nsis.script\", script)\n    }\n\n    const nsisPath = await NSIS_PATH.value\n    const command = path.join(nsisPath, process.platform === \"darwin\" ? \"mac\" : (process.platform === \"win32\" ? \"Bin\" : \"linux\"), process.platform === \"win32\" ? \"makensis.exe\" : \"makensis\")\n    await spawnAndWrite(command, args, script, {\n      // we use NSIS_CONFIG_CONST_DATA_PATH=no to build makensis on Linux, but in any case it doesn't use stubs as MacOS/Windows version, so, we explicitly set NSISDIR\n      env: {...process.env, NSISDIR: nsisPath},\n      cwd: nsisTemplatesDir,\n    }, debug.enabled)\n  }\n\n  private async computeCommonInstallerScriptHeader() {\n    const packager = this.packager\n    const options = this.options\n    const scriptGenerator = new NsisScriptGenerator()\n    const langConfigurator = new LangConfigurator(options)\n\n    scriptGenerator.include(path.join(nsisTemplatesDir, \"include\", \"StdUtils.nsh\"))\n\n    const includeDir = path.join(nsisTemplatesDir, \"include\")\n    scriptGenerator.addIncludeDir(includeDir)\n    scriptGenerator.flags([\"updated\", \"force-run\", \"keep-shortcuts\", \"no-desktop-shortcut\", \"delete-app-data\"])\n\n    createAddLangsMacro(scriptGenerator, langConfigurator)\n\n    const taskManager = new AsyncTaskManager(packager.info.cancellationToken)\n\n    const pluginArch = this.isUnicodeEnabled ? \"x86-unicode\" : \"x86-ansi\"\n    taskManager.add(async () => {\n      scriptGenerator.addPluginDir(pluginArch, path.join(await nsisResourcePathPromise.value, \"plugins\", pluginArch))\n    })\n\n    taskManager.add(async () => {\n      const userPluginDir = path.join(packager.info.buildResourcesDir, pluginArch)\n      const stat = await statOrNull(userPluginDir)\n      if (stat != null && stat.isDirectory()) {\n        scriptGenerator.addPluginDir(pluginArch, userPluginDir)\n      }\n    })\n\n    taskManager.addTask(addCustomMessageFileInclude(\"messages.yml\", packager, scriptGenerator, langConfigurator))\n\n    if (!this.isPortable) {\n      if (options.oneClick === false) {\n        taskManager.addTask(addCustomMessageFileInclude(\"assistedMessages.yml\", packager, scriptGenerator, langConfigurator))\n      }\n\n      taskManager.add(async () => {\n        const customInclude = await packager.getResource(this.options.include, \"installer.nsh\")\n        if (customInclude != null) {\n          scriptGenerator.addIncludeDir(packager.info.buildResourcesDir)\n          scriptGenerator.include(customInclude)\n        }\n      })\n    }\n\n    await taskManager.awaitTasks()\n    return scriptGenerator.build()\n  }\n\n  private async computeFinalScript(originalScript: string, isInstaller: boolean) {\n    const packager = this.packager\n    const options = this.options\n    const langConfigurator = new LangConfigurator(options)\n\n    const scriptGenerator = new NsisScriptGenerator()\n    const taskManager = new AsyncTaskManager(packager.info.cancellationToken)\n\n    if (isInstaller) {\n      // http://stackoverflow.com/questions/997456/nsis-license-file-based-on-language-selection\n      taskManager.add(() => computeLicensePage(packager, options, scriptGenerator, langConfigurator.langs))\n    }\n\n    await taskManager.awaitTasks()\n\n    if (this.isPortable) {\n      return scriptGenerator.build() + originalScript\n    }\n\n    const preCompressedFileExtensions = this.getPreCompressedFileExtensions()\n    if (preCompressedFileExtensions != null) {\n      for (const [arch, dir] of this.archs.entries()) {\n        const preCompressedAssets = await walk(path.join(dir, \"resources\"), (file, stat) => stat.isDirectory() || preCompressedFileExtensions.some(it => file.endsWith(it)))\n        if (preCompressedAssets.length !== 0) {\n          const macro = new NsisScriptGenerator()\n          for (const file of preCompressedAssets) {\n            macro.file(`$INSTDIR\\\\${path.relative(dir, file).replace(/\\//g, \"\\\\\")}`, file)\n          }\n          scriptGenerator.macro(`customFiles_${Arch[arch]}`, macro)\n        }\n      }\n    }\n\n    const fileAssociations = packager.fileAssociations\n    if (fileAssociations.length !== 0) {\n      if (options.perMachine !== true && options.oneClick !== false) {\n        // https://github.com/electron-userland/electron-builder/issues/772\n        throw new InvalidConfigurationError(`Please set perMachine to true — file associations works on Windows only if installed for all users`)\n      }\n\n      scriptGenerator.include(path.join(path.join(nsisTemplatesDir, \"include\"), \"FileAssociation.nsh\"))\n      if (isInstaller) {\n        const registerFileAssociationsScript = new NsisScriptGenerator()\n        for (const item of fileAssociations) {\n          const extensions = asArray(item.ext).map(normalizeExt)\n          for (const ext of extensions) {\n            const customIcon = await packager.getResource(getPlatformIconFileName(item.icon, false), `${extensions[0]}.ico`)\n            let installedIconPath = \"$appExe,0\"\n            if (customIcon != null) {\n              installedIconPath = `$INSTDIR\\\\resources\\\\${path.basename(customIcon)}`\n              registerFileAssociationsScript.file(installedIconPath, customIcon)\n            }\n\n            const icon = `\"${installedIconPath}\"`\n            const commandText = `\"Open with ${packager.appInfo.productName}\"`\n            const command = '\"$appExe $\\\\\"%1$\\\\\"\"'\n            registerFileAssociationsScript.insertMacro(\"APP_ASSOCIATE\", `\"${ext}\" \"${item.name || ext}\" \"${item.description || \"\"}\" ${icon} ${commandText} ${command}`)\n          }\n        }\n        scriptGenerator.macro(\"registerFileAssociations\", registerFileAssociationsScript)\n      }\n      else {\n        const unregisterFileAssociationsScript = new NsisScriptGenerator()\n        for (const item of fileAssociations) {\n          for (const ext of asArray(item.ext)) {\n            unregisterFileAssociationsScript.insertMacro(\"APP_UNASSOCIATE\", `\"${normalizeExt(ext)}\" \"${item.name || ext}\"`)\n          }\n        }\n        scriptGenerator.macro(\"unregisterFileAssociations\", unregisterFileAssociationsScript)\n      }\n    }\n\n    return scriptGenerator.build() + originalScript\n  }\n}\n\nasync function createPackageFileInfo(file: string): Promise<PackageFileInfo> {\n  return {\n    path: file,\n    size: (await stat(file)).size,\n    sha512: await hashFile(file),\n  }\n}"]}
