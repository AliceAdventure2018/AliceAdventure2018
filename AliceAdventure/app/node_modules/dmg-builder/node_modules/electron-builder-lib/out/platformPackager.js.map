{"version":3,"file":"platformPackager.js","sourceRoot":"","sources":["../src/platformPackager.ts"],"names":[],"mappings":"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","sourcesContent":["import BluebirdPromise from \"bluebird-lst\"\nimport { Arch, asArray, AsyncTaskManager, debug, DebugLogger, executeAppBuilder, getArchSuffix, InvalidConfigurationError, isEmptyOrSpaces, log, deepAssign } from \"builder-util\"\nimport { PackageBuilder } from \"builder-util/out/api\"\nimport { statOrNull, unlinkIfExists } from \"builder-util/out/fs\"\nimport { orIfFileNotExist } from \"builder-util/out/promise\"\nimport { readdir, rename } from \"fs-extra-p\"\nimport { Lazy } from \"lazy-val\"\nimport { Minimatch } from \"minimatch\"\nimport * as path from \"path\"\nimport { AppInfo } from \"./appInfo\"\nimport { checkFileInArchive } from \"./asar/asarFileChecker\"\nimport { AsarPackager } from \"./asar/asarUtil\"\nimport { CompressionLevel, Platform, Target, TargetSpecificOptions } from \"./core\"\nimport { copyFiles, FileMatcher, getFileMatchers, GetFileMatchersOptions, getMainFileMatchers } from \"./fileMatcher\"\nimport { createTransformer, isElectronCompileUsed } from \"./fileTransformer\"\nimport { AfterPackContext, AsarOptions, Configuration, FileAssociation, PlatformSpecificBuildOptions } from \"./index\"\nimport { Packager } from \"./packager\"\nimport { unpackElectron, unpackMuon } from \"./packager/dirPackager\"\nimport { PackagerOptions } from \"./packagerApi\"\nimport { copyAppFiles } from \"./util/appFileCopier\"\nimport { computeFileSets, ELECTRON_COMPILE_SHIM_FILENAME } from \"./util/AppFileCopierHelper\"\nimport { AsarIntegrity, computeData } from \"./asar/integrity\"\n\nexport abstract class PlatformPackager<DC extends PlatformSpecificBuildOptions> implements PackageBuilder {\n  get packagerOptions(): PackagerOptions {\n    return this.info.options\n  }\n\n  get buildResourcesDir(): string {\n    return this.info.buildResourcesDir\n  }\n\n  get projectDir(): string {\n    return this.info.projectDir\n  }\n\n  get config(): Configuration {\n    return this.info.config\n  }\n\n  readonly platformSpecificBuildOptions: DC\n\n  get resourceList(): Promise<Array<string>> {\n    return this._resourceList.value\n  }\n\n  private readonly _resourceList = new Lazy<Array<string>>(() => orIfFileNotExist(readdir(this.info.buildResourcesDir), []))\n\n  readonly appInfo: AppInfo\n\n  protected constructor(readonly info: Packager, readonly platform: Platform) {\n    this.platformSpecificBuildOptions = PlatformPackager.normalizePlatformSpecificBuildOptions((this.config as any)[platform.buildConfigurationKey])\n    this.appInfo = this.prepareAppInfo(info.appInfo)\n  }\n\n  get compression(): CompressionLevel {\n    const compression = this.platformSpecificBuildOptions.compression\n    // explicitly set to null - request to use default value instead of parent (in the config)\n    if (compression === null) {\n      return \"normal\"\n    }\n    return compression || this.config.compression || \"normal\"\n  }\n\n  get debugLogger(): DebugLogger {\n    return this.info.debugLogger\n  }\n\n  abstract get defaultTarget(): Array<string>\n\n  protected prepareAppInfo(appInfo: AppInfo) {\n    return appInfo\n  }\n\n  private static normalizePlatformSpecificBuildOptions(options: any | null | undefined): any {\n    return options == null ? Object.create(null) : options\n  }\n\n  abstract createTargets(targets: Array<string>, mapper: (name: string, factory: (outDir: string) => Target) => void): void\n\n  protected getCscPassword(): string {\n    const password = this.doGetCscPassword()\n    if (isEmptyOrSpaces(password)) {\n      log.info({reason: \"CSC_KEY_PASSWORD is not defined\"}, \"empty password will be used for code signing\")\n      return \"\"\n    }\n    else {\n      return password!.trim()\n    }\n  }\n\n  protected getCscLink(extraEnvName?: string | null): string | null | undefined {\n    // allow to specify as empty string\n    const envValue = chooseNotNull(extraEnvName == null ? null : process.env[extraEnvName], process.env.CSC_LINK)\n    return chooseNotNull(chooseNotNull(this.info.config.cscLink, this.platformSpecificBuildOptions.cscLink), envValue)\n  }\n\n  protected doGetCscPassword(): string | null | undefined {\n    // allow to specify as empty string\n    return chooseNotNull(chooseNotNull(this.info.config.cscKeyPassword, this.platformSpecificBuildOptions.cscKeyPassword), process.env.CSC_KEY_PASSWORD)\n  }\n\n  protected computeAppOutDir(outDir: string, arch: Arch): string {\n    return this.packagerOptions.prepackaged || path.join(outDir, `${this.platform.buildConfigurationKey}${getArchSuffix(arch)}${this.platform === Platform.MAC ? \"\" : \"-unpacked\"}`)\n  }\n\n  dispatchArtifactCreated(file: string, target: Target | null, arch: Arch | null, safeArtifactName?: string | null) {\n    this.info.dispatchArtifactCreated({\n      file, safeArtifactName, target, arch,\n      packager: this,\n    })\n  }\n\n  async pack(outDir: string, arch: Arch, targets: Array<Target>, taskManager: AsyncTaskManager): Promise<any> {\n    const appOutDir = this.computeAppOutDir(outDir, arch)\n    await this.doPack(outDir, appOutDir, this.platform.nodeName, arch, this.platformSpecificBuildOptions, targets)\n    this.packageInDistributableFormat(appOutDir, arch, targets, taskManager)\n  }\n\n  protected packageInDistributableFormat(appOutDir: string, arch: Arch, targets: Array<Target>, taskManager: AsyncTaskManager): void {\n    taskManager.addTask(\n      BluebirdPromise.map(targets, it => it.isAsyncSupported ? it.build(appOutDir, arch) : null)\n        .then(() => BluebirdPromise.each(targets, it => it.isAsyncSupported ? null : it.build(appOutDir, arch)))\n    )\n  }\n\n  private getExtraFileMatchers(isResources: boolean, appOutDir: string, options: GetFileMatchersOptions): Array<FileMatcher> | null {\n    const base = isResources ? this.getResourcesDir(appOutDir) : (this.platform === Platform.MAC ? path.join(appOutDir, `${this.appInfo.productFilename}.app`, \"Contents\") : appOutDir)\n    return getFileMatchers(this.config, isResources ? \"extraResources\" : \"extraFiles\", this.projectDir, base, options)\n  }\n\n  get electronDistMacOsAppName() {\n    return this.config.muonVersion == null ? \"Electron.app\" : \"Brave.app\"\n  }\n\n  get electronDistExecutableName() {\n    return this.config.muonVersion == null ? \"electron\" : \"brave\"\n  }\n\n  get electronDistMacOsExecutableName() {\n    return this.config.muonVersion == null ? \"Electron\" : \"Brave\"\n  }\n\n  protected async doPack(outDir: string, appOutDir: string, platformName: string, arch: Arch, platformSpecificBuildOptions: DC, targets: Array<Target>) {\n    if (this.packagerOptions.prepackaged != null) {\n      return\n    }\n\n    const asarOptions = await this.computeAsarOptions(platformSpecificBuildOptions)\n    const macroExpander = (it: string) => this.expandMacro(it, arch == null ? null : Arch[arch], {\"/*\": \"{,/**/*}\"})\n\n    const resourcesPath = this.platform === Platform.MAC ? path.join(appOutDir, this.electronDistMacOsAppName, \"Contents\", \"Resources\") : path.join(appOutDir, \"resources\")\n\n    const muonVersion = this.config.muonVersion\n    const isElectron = muonVersion == null\n    const config = this.config\n    log.info({\n      platform: platformName,\n      arch: Arch[arch], [isElectron ? `electron` : `muon`]: isElectron ? config.electronVersion!! : muonVersion!!,\n      appOutDir: log.filePath(appOutDir),\n    }, `packaging`)\n\n    if (this.info.isPrepackedAppAsar) {\n      await unpackElectron(this, appOutDir, platformName, Arch[arch], config.electronVersion!)\n    }\n    else {\n      await (isElectron ? unpackElectron(this, appOutDir, platformName, Arch[arch], config.electronVersion!) : unpackMuon(this, appOutDir, platformName, Arch[arch], muonVersion!))\n    }\n\n    const excludePatterns: Array<Minimatch> = []\n\n    const computeParsedPatterns = (patterns: Array<FileMatcher> | null) => {\n      if (patterns != null) {\n        for (const pattern of patterns) {\n          pattern.computeParsedPatterns(excludePatterns, this.info.projectDir)\n        }\n      }\n    }\n\n    const getFileMatchersOptions: GetFileMatchersOptions = {\n      macroExpander,\n      customBuildOptions: platformSpecificBuildOptions,\n      outDir,\n    }\n    const extraResourceMatchers = this.getExtraFileMatchers(true, appOutDir, getFileMatchersOptions)\n    computeParsedPatterns(extraResourceMatchers)\n    const extraFileMatchers = this.getExtraFileMatchers(false, appOutDir, getFileMatchersOptions)\n    computeParsedPatterns(extraFileMatchers)\n\n    const packContext: AfterPackContext = {\n      appOutDir, outDir, arch, targets,\n      packager: this,\n      electronPlatformName: platformName,\n    }\n\n    const taskManager = new AsyncTaskManager(this.info.cancellationToken)\n\n    this.copyAppFiles(taskManager, asarOptions, resourcesPath, outDir, platformSpecificBuildOptions, excludePatterns, macroExpander)\n\n    taskManager.addTask(unlinkIfExists(path.join(resourcesPath, \"default_app.asar\")))\n    taskManager.addTask(unlinkIfExists(path.join(appOutDir, \"version\")))\n    taskManager.addTask(this.postInitApp(packContext))\n    if (this.platform !== Platform.MAC) {\n      taskManager.addTask(rename(path.join(appOutDir, \"LICENSE\"), path.join(appOutDir, \"LICENSE.electron.txt\")).catch(() => {/* ignore */}))\n    }\n\n    await taskManager.awaitTasks()\n    await this.beforeCopyExtraFiles(appOutDir, asarOptions == null ? null : await computeData(resourcesPath, asarOptions.externalAllowed ? {externalAllowed: true} : null))\n    await BluebirdPromise.each([extraResourceMatchers, extraFileMatchers], it => copyFiles(it))\n\n    if (this.info.cancellationToken.cancelled) {\n      return\n    }\n\n    await this.info.afterPack(packContext)\n    await this.sanityCheckPackage(appOutDir, asarOptions != null)\n    await this.signApp(packContext)\n    await this.info.afterSign(packContext)\n  }\n\n  protected async beforeCopyExtraFiles(appOutDir: string, asarIntegrity: AsarIntegrity | null) {\n    // empty impl\n  }\n\n  private copyAppFiles(taskManager: AsyncTaskManager, asarOptions: AsarOptions | null, resourcePath: string, outDir: string, platformSpecificBuildOptions: DC, excludePatterns: Array<Minimatch>, macroExpander: ((it: string) => string)) {\n    const appDir = this.info.appDir\n    const config = this.config\n    const isElectronCompile = asarOptions != null && isElectronCompileUsed(this.info)\n\n    const defaultDestination = path.join(resourcePath, \"app\")\n\n    const mainMatchers = getMainFileMatchers(appDir, defaultDestination, macroExpander, platformSpecificBuildOptions, this, outDir, isElectronCompile)\n    if (excludePatterns.length > 0) {\n      for (const matcher of mainMatchers) {\n        matcher.excludePatterns = excludePatterns\n      }\n    }\n    const transformer = createTransformer(appDir, config, isElectronCompile ? {\n      originalMain: this.info.metadata.main,\n      main: ELECTRON_COMPILE_SHIM_FILENAME, ...config.extraMetadata\n    } : config.extraMetadata)\n    const _computeFileSets = (matchers: Array<FileMatcher>) => {\n      return computeFileSets(matchers, transformer, this.info, isElectronCompile)\n        .then(it => it.filter(it => it.files.length > 0))\n    }\n\n    if (this.info.isPrepackedAppAsar) {\n      taskManager.addTask(BluebirdPromise.each(_computeFileSets([new FileMatcher(appDir, resourcePath, macroExpander)]), it => copyAppFiles(it, this.info)))\n    }\n    else if (asarOptions == null) {\n      taskManager.addTask(BluebirdPromise.each(_computeFileSets(mainMatchers), it => copyAppFiles(it, this.info)))\n    }\n    else {\n      const unpackPattern = getFileMatchers(config, \"asarUnpack\", appDir, defaultDestination, {\n        macroExpander,\n        customBuildOptions: platformSpecificBuildOptions,\n        outDir,\n      })\n      const fileMatcher = unpackPattern == null ? null : unpackPattern[0]\n      taskManager.addTask(_computeFileSets(mainMatchers)\n        .then(fileSets => new AsarPackager(appDir, resourcePath, asarOptions, fileMatcher == null ? null : fileMatcher.createFilter()).pack(fileSets, this)))\n    }\n  }\n\n  // tslint:disable-next-line:no-empty\n  protected async postInitApp(packContext: AfterPackContext): Promise<any> {\n  }\n\n  protected signApp(packContext: AfterPackContext): Promise<any> {\n    return Promise.resolve()\n  }\n\n  async getIconPath(): Promise<string | null> {\n    return null\n  }\n\n  private async computeAsarOptions(customBuildOptions: DC): Promise<AsarOptions | null> {\n    function errorMessage(name: string) {\n      return `${name} is deprecated is deprecated and not supported — please use asarUnpack`\n    }\n\n    const buildMetadata = this.config as any\n    if (buildMetadata[\"asar-unpack\"] != null) {\n      throw new Error(errorMessage(\"asar-unpack\"))\n    }\n    if (buildMetadata[\"asar-unpack-dir\"] != null) {\n      throw new Error(errorMessage(\"asar-unpack-dir\"))\n    }\n\n    const platformSpecific = customBuildOptions.asar\n    const result = platformSpecific == null ? this.config.asar : platformSpecific\n    if (result === false) {\n      const appAsarStat = await statOrNull(path.join(this.info.appDir, \"app.asar\"))\n      //noinspection ES6MissingAwait\n      if (appAsarStat == null || !appAsarStat.isFile()) {\n        log.warn({\n          solution: \"enable asar and use asarUnpack to unpack files that must be externally available\",\n        }, \"asar using is disabled — it is strongly not recommended\")\n      }\n      return null\n    }\n\n    if (result == null || result === true) {\n      return {}\n    }\n\n    for (const name of [\"unpackDir\", \"unpack\"]) {\n      if ((result as any)[name] != null) {\n        throw new Error(errorMessage(`asar.${name}`))\n      }\n    }\n    return deepAssign({}, result)\n  }\n\n  public getElectronSrcDir(dist: string): string {\n    return path.resolve(this.projectDir, dist)\n  }\n\n  public getElectronDestinationDir(appOutDir: string): string {\n    return appOutDir\n  }\n\n  public getResourcesDir(appOutDir: string): string {\n    return this.platform === Platform.MAC ? this.getMacOsResourcesDir(appOutDir) : path.join(appOutDir, \"resources\")\n  }\n\n  public getMacOsResourcesDir(appOutDir: string): string {\n    return path.join(appOutDir, `${this.appInfo.productFilename}.app`, \"Contents\", \"Resources\")\n  }\n\n  private async checkFileInPackage(resourcesDir: string, file: string, messagePrefix: string, isAsar: boolean) {\n    const relativeFile = path.relative(this.info.appDir, path.resolve(this.info.appDir, file))\n    if (isAsar) {\n      await checkFileInArchive(path.join(resourcesDir, \"app.asar\"), relativeFile, messagePrefix)\n      return\n    }\n\n    const pathParsed = path.parse(file)\n    // Even when packaging to asar is disabled, it does not imply that the main file can not be inside an .asar archive.\n    // This may occur when the packaging is done manually before processing with electron-builder.\n    if (pathParsed.dir.includes(\".asar\")) {\n      // The path needs to be split to the part with an asar archive which acts like a directory and the part with\n      // the path to main file itself. (e.g. path/arch.asar/dir/index.js -> path/arch.asar, dir/index.js)\n      // noinspection TypeScriptValidateJSTypes\n      const pathSplit: Array<string> = pathParsed.dir.split(path.sep)\n      let partWithAsarIndex = 0\n      pathSplit.some((pathPart: string, index: number) => {\n        partWithAsarIndex = index\n        return pathPart.endsWith(\".asar\")\n      })\n      const asarPath = path.join.apply(path, pathSplit.slice(0, partWithAsarIndex + 1))\n      let mainPath = pathSplit.length > (partWithAsarIndex + 1) ? path.join.apply(pathSplit.slice(partWithAsarIndex + 1)) : \"\"\n      mainPath += path.join(mainPath, pathParsed.base)\n      await checkFileInArchive(path.join(resourcesDir, \"app\", asarPath), mainPath, messagePrefix)\n    }\n    else {\n      const outStat = await statOrNull(path.join(resourcesDir, \"app\", relativeFile))\n      if (outStat == null) {\n        throw new Error(`${messagePrefix} \"${relativeFile}\" does not exist. Seems like a wrong configuration.`)\n      }\n      else {\n        //noinspection ES6MissingAwait\n        if (!outStat.isFile()) {\n          throw new Error(`${messagePrefix} \"${relativeFile}\" is not a file. Seems like a wrong configuration.`)\n        }\n      }\n    }\n  }\n\n  private async sanityCheckPackage(appOutDir: string, isAsar: boolean): Promise<any> {\n    const outStat = await statOrNull(appOutDir)\n    if (outStat == null) {\n      throw new Error(`Output directory \"${appOutDir}\" does not exist. Seems like a wrong configuration.`)\n    }\n    else {\n      //noinspection ES6MissingAwait\n      if (!outStat.isDirectory()) {\n        throw new Error(`Output directory \"${appOutDir}\" is not a directory. Seems like a wrong configuration.`)\n      }\n    }\n\n    const resourcesDir = this.getResourcesDir(appOutDir)\n    await this.checkFileInPackage(resourcesDir, this.info.metadata.main || \"index.js\", \"Application entry file\", isAsar)\n    await this.checkFileInPackage(resourcesDir, \"package.json\", \"Application\", isAsar)\n  }\n\n  computeSafeArtifactName(suggestedName: string | null, ext: string, arch?: Arch | null, skipArchIfX64 = true): string | null {\n    // GitHub only allows the listed characters in file names.\n    if (suggestedName != null && isSafeGithubName(suggestedName)) {\n      return null\n    }\n\n    // tslint:disable-next-line:no-invalid-template-strings\n    return this.computeArtifactName(\"${name}-${version}-${arch}.${ext}\", ext, skipArchIfX64 && arch === Arch.x64 ? null : arch)\n  }\n\n  expandArtifactNamePattern(targetSpecificOptions: TargetSpecificOptions | null | undefined, ext: string, arch?: Arch | null, defaultPattern?: string, skipArchIfX64 = true): string {\n    let pattern = targetSpecificOptions == null ? null : targetSpecificOptions.artifactName\n    if (pattern == null) {\n      // tslint:disable-next-line:no-invalid-template-strings\n      pattern = this.platformSpecificBuildOptions.artifactName || this.config.artifactName || defaultPattern || \"${productName}-${version}-${arch}.${ext}\"\n    }\n    return this.computeArtifactName(pattern, ext, skipArchIfX64 && arch === Arch.x64 ? null : arch)\n  }\n\n  private computeArtifactName(pattern: any, ext: string, arch: Arch | null | undefined) {\n    let archName: string | null = arch == null ? null : Arch[arch]\n    if (arch === Arch.x64) {\n      if (ext === \"AppImage\" || ext === \"rpm\") {\n        archName = \"x86_64\"\n      }\n      else if (ext === \"deb\" || ext === \"snap\") {\n        archName = \"amd64\"\n      }\n    }\n    else if (arch === Arch.ia32) {\n      if (ext === \"deb\" || ext === \"AppImage\" || ext === \"snap\") {\n        archName = \"i386\"\n      }\n      else if (ext === \"pacman\" || ext === \"rpm\") {\n        archName = \"i686\"\n      }\n    }\n\n    return this.expandMacro(pattern, this.platform === Platform.MAC ? null : archName, {\n      ext\n    })\n  }\n\n  expandMacro(pattern: string, arch?: string | null, extra: any = {}, isProductNameSanitized = true): string {\n    if (arch == null) {\n      pattern = pattern\n      // tslint:disable-next-line:no-invalid-template-strings\n        .replace(\"-${arch}\", \"\")\n        // tslint:disable-next-line:no-invalid-template-strings\n        .replace(\" ${arch}\", \"\")\n        // tslint:disable-next-line:no-invalid-template-strings\n        .replace(\"_${arch}\", \"\")\n        // tslint:disable-next-line:no-invalid-template-strings\n        .replace(\"/${arch}\", \"\")\n    }\n\n    const appInfo = this.appInfo\n    return pattern.replace(/\\${([_a-zA-Z./*]+)}/g, (match, p1): string => {\n      switch (p1) {\n        case \"productName\":\n          return isProductNameSanitized ? appInfo.productFilename : appInfo.productName\n\n        case \"arch\":\n          if (arch == null) {\n            // see above, we remove macro if no arch\n            return \"\"\n          }\n          return arch\n\n        case \"os\":\n          return this.platform.buildConfigurationKey\n\n        case \"platform\":\n          return process.platform\n\n        case \"channel\":\n          return appInfo.channel || \"latest\"\n\n        default:\n          if (p1 in appInfo) {\n            return (appInfo as any)[p1]\n          }\n\n          if (p1.startsWith(\"env.\")) {\n            const envName = p1.substring(\"env.\".length)\n            const envValue = process.env[envName]\n            if (envValue == null) {\n              throw new InvalidConfigurationError(`cannot expand pattern \"${pattern}\": env ${envName} is not defined`, \"ERR_ELECTRON_BUILDER_ENV_NOT_DEFINED\")\n            }\n            return envValue\n          }\n\n          const value = extra[p1]\n          if (value == null) {\n            throw new InvalidConfigurationError(`cannot expand pattern \"${pattern}\": macro ${p1} is not defined`, \"ERR_ELECTRON_BUILDER_MACRO_NOT_DEFINED\")\n          }\n          else {\n            return value\n          }\n      }\n    })\n  }\n\n  generateName(ext: string | null, arch: Arch, deployment: boolean, classifier: string | null = null): string {\n    let c: string | null = null\n    let e: string | null = null\n    if (arch === Arch.x64) {\n      if (ext === \"AppImage\") {\n        c = \"x86_64\"\n      }\n      else if (ext === \"deb\") {\n        c = \"amd64\"\n      }\n    }\n    else if (arch === Arch.ia32 && ext === \"deb\") {\n      c = \"i386\"\n    }\n    else if (ext === \"pacman\") {\n      if (arch === Arch.ia32) {\n        c = \"i686\"\n      }\n      e = \"pkg.tar.xz\"\n    }\n    else {\n      c = Arch[arch]\n    }\n\n    if (c == null) {\n      c = classifier\n    }\n    else if (classifier != null) {\n      c += `-${classifier}`\n    }\n    if (e == null) {\n      e = ext\n    }\n    return this.generateName2(e, c, deployment)\n  }\n\n  generateName2(ext: string | null, classifier: string | null | undefined, deployment: boolean): string {\n    const dotExt = ext == null ? \"\" : `.${ext}`\n    const separator = ext === \"deb\" ? \"_\" : \"-\"\n    return `${deployment ? this.appInfo.name : this.appInfo.productFilename}${separator}${this.appInfo.version}${classifier == null ? \"\" : `${separator}${classifier}`}${dotExt}`\n  }\n\n  getTempFile(suffix: string): Promise<string> {\n    return this.info.tempDirManager.getTempFile({suffix})\n  }\n\n  get fileAssociations(): Array<FileAssociation> {\n    return asArray(this.config.fileAssociations).concat(asArray(this.platformSpecificBuildOptions.fileAssociations))\n  }\n\n  async getResource(custom: string | null | undefined, ...names: Array<string>): Promise<string | null> {\n    const resourcesDir = this.info.buildResourcesDir\n    if (custom === undefined) {\n      const resourceList = await this.resourceList\n      for (const name of names) {\n        if (resourceList.includes(name)) {\n          return path.join(resourcesDir, name)\n        }\n      }\n    }\n    else if (custom != null && !isEmptyOrSpaces(custom)) {\n      const resourceList = await this.resourceList\n      if (resourceList.includes(custom)) {\n        return path.join(resourcesDir, custom)\n      }\n\n      let p = path.resolve(resourcesDir, custom)\n      if (await statOrNull(p) == null) {\n        p = path.resolve(this.projectDir, custom)\n        if (await statOrNull(p) == null) {\n          throw new InvalidConfigurationError(`cannot find specified resource \"${custom}\", nor relative to \"${resourcesDir}\", neither relative to project dir (\"${this.projectDir}\")`)\n        }\n      }\n      return p\n    }\n    return null\n  }\n\n  get forceCodeSigning(): boolean {\n    const forceCodeSigningPlatform = this.platformSpecificBuildOptions.forceCodeSigning\n    return (forceCodeSigningPlatform == null ? this.config.forceCodeSigning : forceCodeSigningPlatform) || false\n  }\n\n  protected async getOrConvertIcon(format: IconFormat): Promise<string | null> {\n    const iconPath = this.platformSpecificBuildOptions.icon || this.config.icon\n    if (iconPath != null) {\n      const iconInfos = await this.resolveIcon([iconPath], format)\n      return (iconInfos)[0].file\n    }\n\n    const resourceList = await this.resourceList\n    const resourcesDir = this.info.buildResourcesDir\n    const sourceNames = [`icon.${format === \"set\" ? \"png\" : format}`, \"icon.png\", \"icons\"]\n    if (format === \"ico\") {\n      sourceNames.push(\"icon.icns\")\n    }\n    for (const fileName of sourceNames) {\n      if (resourceList.includes(fileName)) {\n        return (await this.resolveIcon([path.join(resourcesDir, fileName)], format))[0].file\n      }\n    }\n\n    log.warn({reason: \"application icon is not set\"}, \"default Electron icon is used\")\n    return null\n  }\n\n  // convert if need, validate size (it is a reason why tool is called even if file has target extension (already specified as foo.icns for example))\n  async resolveIcon(sources: Array<string>, outputFormat: IconFormat): Promise<Array<IconInfo>> {\n    const args = [\n      \"icon\",\n      \"--format\", outputFormat,\n      \"--root\", this.buildResourcesDir,\n      \"--root\", this.projectDir,\n      \"--out\", path.resolve(this.projectDir, this.config.directories!!.output!!, `.icon-${outputFormat}`),\n    ]\n    for (const source of sources) {\n      args.push(\"--input\", source)\n    }\n\n    const rawResult = await executeAppBuilder(args)\n    let result: IconConvertResult\n    try {\n      result = JSON.parse(rawResult)\n    }\n    catch (e) {\n      throw new Error(`Cannot parse result: ${e.message}: ${rawResult}`)\n    }\n\n    const errorMessage = result.error\n    if (errorMessage != null) {\n      throw new InvalidConfigurationError(errorMessage, result.errorCode)\n    }\n    return result.icons!!\n  }\n}\n\nexport interface IconInfo {\n  file: string\n  size: number\n}\n\ninterface IconConvertResult {\n  icons?: Array<IconInfo>\n\n  error?: string\n  errorCode?: string\n}\n\nexport type IconFormat = \"icns\" | \"ico\" | \"set\"\n\nexport function isSafeGithubName(name: string) {\n  return /^[0-9A-Za-z._-]+$/.test(name)\n}\n\n// remove leading dot\nexport function normalizeExt(ext: string) {\n  return ext.startsWith(\".\") ? ext.substring(1) : ext\n}\n\nexport function resolveFunction<T>(executor: T | string): T {\n  if (executor == null || typeof executor !== \"string\") {\n    return executor\n  }\n\n  let p = executor as string\n  if (p.startsWith(\".\")) {\n    p = path.resolve(p)\n  }\n  try {\n    p = require.resolve(p)\n  }\n  catch (e) {\n    debug(e)\n    p = path.resolve(p)\n  }\n\n  const m = require(p)\n  return m.default || m\n}\n\nexport function chooseNotNull(v1: string | null | undefined, v2: string | null | undefined): string | null | undefined {\n  return v1 == null ? v2 : v1\n}"]}
