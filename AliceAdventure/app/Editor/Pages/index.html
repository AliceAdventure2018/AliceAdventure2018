<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
	<title> Alice's Adventure </title>
	<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="css/layout.css">	 
		<script>document.write('<base href="' + document.location + '" />');</script>	 
		<script data-semver="1.2.13" src="http://code.angularjs.org/1.2.13/angular.js" data-require="angular.js@1.2.x"></script> 
	 <script src="js/app.js"></script>
		<script src="js/resizer.js"></script>	 

		<link rel="stylesheet" href="../../Resources/bootstrap.min.css">
		<script type="text/javascript" src="../../Resources/jquery-2.0.3.min.js"></script>
		<script type="text/javascript" src="../../Resources/modal.js"></script>
		<script type="text/javascript" src="../../Resources/util.js"></script>
		<script type="text/javascript" src="../../Resources/vue.js"></script>
		<script type="text/javascript" src="../scripts/index.js"></script>
</head>
<body ng-controller="MainCtrl">

	<nav  id="topnav">
    <a class="float-left" id="brand" href="#">
    <img src="./src/AliceAdventure_logo.svg" width="25" height="25" alt="">&nbsp; Alice's Adventure
    </a>			 
    <!--button  onclick="switchDesignView()" class="float-left" id="design-button" >Design </button>

    <button  onclick="switchCodeView()"  class="float-left"  id ="code-button" >Code</button-->

    <button id="setting-button"  class="float-right" data-toggle="modal" data-target="#setting">
               Setting
    </button>

    <button onclick="AliceEditor.File.BuildProject()" id="build-button"  class="float-right" >
    					 Build
    </button>

    <button onclick="AliceEditor.File.RunProject()" id="run-button"  class="float-right" >
    					 Run
    </button>
    <button onclick="AliceEditor.File.SaveProject()" id="save-button"  class="float-right" >
    					 Save
    </button>			 
	</nav>

	<script type="text/javascript">
		
			function editInPlace(event){
			
					var targetTitle = event.target || event.srcElement;
					targetTitle.setAttribute('oldText', targetTitle.innerHTML); // not actually required. I use target just in case you want to cancel and set the original text back.
					var origianalText = targetTitle.innerHTML;

					var textBox = document.createElement('INPUT');
						textBox.setAttribute('type', 'text');
						textBox.style['width'] ='100px';
						textBox.value = targetTitle.innerHTML;

						
						textBox.onblur = function() {
							
							var newValue = textBox.value; //targetTitle.value
							console.log("on blur");
							console.log(newValue);

							if(newValue === ''){
								console.log("null detected");
								//targetTitle.parentNode.innerHTML = origianalText;
								targetTitle.innerHTML = origianalText;

							} else {
								if(newValue.length >25){
									alert("Name should be less than 25 characters");
									targetTitle.innerHTML = origianalText;
									//targetTitle.parentNode.innerHTML = origianalText;
								} else {
									targetTitle.innerHTML = newValue;
									 //targetTitle.parentNode.innerHTML = newValue;
								 }
							}
						 // alert("Your new value: \n\n" + newValue);
						}

					targetTitle.innerHTML = '';

					targetTitle.appendChild(textBox);
			
		}


		function getElementsByClassName(className, tag, elm){
			var testClass = new RegExp("(^|\\s)" + className + "(\\s|$)");
			var tag = tag || "*";
			var elm = elm || document;
			var elements = (tag == "*" && elm.all)? elm.all : elm.getElementsByTagName(tag);
			var returnElements = [];
			var current;
			var length = elements.length;
			for(var i=0; i<length; i++){
				current = elements[i];
				if(testClass.test(current.className)){
					returnElements.push(current);
				}
			}
			return returnElements;
		}
	</script>

	<script type="text/javascript">
		function switchGalleryView() {
				var x = document.getElementById("gallery");
				var y = document.getElementById("object-list");

				if (x.style.display === "none" || y.style.display ==="block") {
						x.style.display = "block";
						y.style.display = "none";
				} else {
					
				}
		}

		function switchListView() {
				var y = document.getElementById("gallery");
				var x = document.getElementById("object-list");

				if (x.style.display === "none" || y.style.display ==="block") {
						x.style.display = "block";
						y.style.display = "none";
				} else {
					
				}
		}

		function switchCategoryView() {
			
			/*if (document.addEventListener){}else if (document.attachEvent) {  }
			*/
			
			document.addEventListener("click", function(event){

				var selected = document.getElementsByClassName("selected");
				var unselecteds = document.getElementsByClassName("unselecteds");

				for(i=0;i<selected.length;i++){
					selected[i].className ="unselecteds";
				}
				
				var targetElement = event.target || event.srcElement;
				if(targetElement.tagName === 'A'){
				targetElement.className = "selected";
				unselecteds = document.getElementsByClassName("unselecteds");
				}

				if(selected.length === 1){

					var assetName = targetElement.getAttribute("aria-controls");
					document.getElementById(assetName).style.display = "block";
					//console.log(document.getElementById(assetName));

					var assetName_unselected = [];


					if(unselecteds.length !== null){
						for(j=0; j<unselecteds.length;j++){
							assetName_unselected[j]= unselecteds[j].getAttribute("aria-controls");
						}

						for(t=0; t<unselecteds.length;t++){
							document.getElementById(assetName_unselected[t]).style.display = "none";
						} 

						assetName_unselected = null;
						unselecteds = null;
						
					//console.log(targetElement.getAttribute("aria-controls"));
					}
				} 


			});
			

		}
	</script>

				<!-- Modal -->
  <div class="modal fade" id="setting" tabindex="-1" role="dialog" aria-labelledby="settingTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="settingLongTitle">Game Setting</h5>
          <button type="button" id="close-icon-button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Game Resolution <select></select></p> 
          <p>Number of Containers in Inventory: <select></select></p>
          <p>Start Scene <select></select></p>
        </div>
        <div class="modal-footer">
          <button type="button" id="close-button" data-dismiss="modal">Close</button>
          <button type="button"  id="save-button">Save changes</button>
        </div>
      </div>
    </div>
  </div>

	<div id="design-view" style="display: block;">

		<div id="first-column">		

			<div id="design-editor">
        <h6 class="window-title">SCENE EDITOR</h6>
				<div id="add-scene">
					<button type="button"  class="btn btn-outline-success btn-sm" id="add-scene-button" v-on:click='addScene'> Add Scene</button></div>
			</div>
		
		  <div id="first-column-second-row">

        <div id="wrap-first-column-second-row">
      		<div id="gallery" >
            <h6 class="window-title" >GALLERY</h6>
      			<div id="tabList">
        			<ul >
    						<li class="nav-item"><a onclick="switchCategoryView()"  href="#door-asset" aria-controls="door-asset" class="unselecteds">
    						Pictures</a></li>
    						<li class="nav-item"><a onclick="switchCategoryView()" href="#key-asset"  aria-controls="key-asset" class="unselecteds">Sounds</a></li>
          			<!--<div class="tab-list" id="tabList">
          			<ul class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"-->
              </ul>
  		      </div>
						<div id="tabContent">
							<div id="door-asset" style="display: none;">
								<div class="assets">
									<ul>
									<!-- bind the gallery data -->
										<li v-for="pic in pictures" v-on:click="chooseObj(pic)"> <div class="asset"><img v-bind:src="'../../'+pic.src"> </div><p v-html='pic.name'></p>
										</li>
										
									</ul>
								</div>
							</div>

							<div id="key-asset" style="display: none;">
								<div class="assets">
									<ul>
                  <!-- bind the gallery data -->
                    <li v-for="sound in sounds"> <div class="asset"><img v-bind:src="'../../'+sound.src"> </div><p v-html='sound.name'></p>
                    </li>                    
                  </ul>
								</div>
							</div>
						</div>
		      </div>

<script type="text/javascript" >
			function showListView(event) {
				//document.addEventListener("click", function(event){
					var targetElement = event.target || event.srcElement;
					var parentTargetElement = targetElement.parentElement;
					console.log(parentTargetElement.nodeName);
					var childTargetElements = parentTargetElement.childNodes;
					var childTargetElement;
					var childTargetElementLi;

					var icon;
	

					for(k=0;k<parentTargetElement.childNodes.length;k++){
						if(parentTargetElement.childNodes[k].tagName === 'I')
						icon = parentTargetElement.childNodes[k];
					}
					

					if(childTargetElements !== null){
						for(t=0; t<childTargetElements.length; t++){
							if(childTargetElements[t].tagName === 'OL'){
								childTargetElement = childTargetElements[t];
							} 
						}

						
					}

					for(j=0; j<childTargetElement.childNodes.length; j++){
						if(childTargetElement.childNodes[j].tagName === 'LI'){
							childTargetElementLi = childTargetElement.childNodes[j];
						}
					}

					
					if(childTargetElementLi !== null){ 
							if(childTargetElement.style.display === "none"){
								icon.className = "down";
								childTargetElement.style.display = "block";
							}else if(childTargetElement.style.display === "block"){
										childTargetElement.style.display = "none";
										icon.className = "right";
							} 
					}
					
				//});
			}
		</script>

      		<div id="object-list" ><h6 class="window-title" >OBJECT LIST</h6>
      			<!-- if show object list on -->
      			<ol v-if='showObjectList' class="object-tree">
      				<li v-for="scene in sceneList" v-on:click="onSelect(scene)">
        				<!-- loop all scenes and objects 
        				<label class="object_label" v-html="scene.name"></label>
        				<input type="checkbox" /> -->
        				<i class="down"></i><button onclick="showListView(event)"  v-html="scene.name">hello</button>
      					<ol class="object_label" style="display:block;">
      						<li v-for="object in objectList" v-on:click="onSelect(object)" v-if="object.bindScene.id == scene.id">
      							<!--<label class="object_label" v-html="object.name"></label>
      							<input type="checkbox"/>-->
      							<button v-html="object.name" v-on:dblclick='deleteObject(object)'></button>
      						</li>						
      					</ol>
      				</li>
      				<!--li>
      					<label class="object_label" for="inventory">Inventory</label>
      				</li-->
      			</ol>
      		</div>
      		<div id="gallery-list-resizer" 
      			resizer="vertical-left" 
      			resizer-width="6" 
      			resizer-left="#gallery" 
      			resizer-right="#object-list"
      			resizer-max="466"
      			>
      		</div>

      	</div>
      </div>
      <div id="design-editor-resizer" 
      		resizer="horizontal" 
      		resizer-height="6" 
      		resizer-top="#design-editor" 
      		resizer-bottom="#first-column-second-row"
      		resizer-min="450"
      		>
      </div>
    </div>
	
		<div id="second-column">
			<div id="interaction-editor">
        <h6 class="window-title">INTERACTION EDITOR</h6>
		    <div class="interaction-box" v-if='viewEnabled' v-for='ntra in interactions'>

				<div>
          <span ondblclick="editInPlace(event)" class="editInPlace">Title</span>
          <a v-on:click="deleteInteraction(ntra)"><img id="interaction-box-close" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEpSURBVGhD7dk9CsJAEIbheABb7fUkHkKPY2krnskz2HoLO0Fn1A+WEEJ2szs/Mi98qKl80E2TLoqi6G9a0I609eeTbnva7vs2P0a8aDeaJuZAe9IetC1fyI2/PCM0MUDwdzjxhdI0MdUQSANTHYEkMc0QSALTHIFaYsQQqAVGHIFqYtQQqAZGHYHmYMwgUAnGHALlYMwi0BSMeQQaw7hBoCGMOwRKMXeaSwRiDCMYwLvQXJb+nXj9M+OiFHGm9c+Mi4YOdnpmXGDG7k5uMFNuseYxUxDILCYHgcxhShDIDGYOAqljaiCQGqYmAoljWiCQGKYlAjXHSCBQM4wkAlXHaCBQNYwmAvUxK1p2/MyOH3dpIRAwV9qSL5S0+b1qx79EMSKKoshaXfcGi/zGyoPvvCcAAAAASUVORK5CYII="/></a>
        </div>
				<h6 id="event-box-title" class="window-title">Event</h6>
				<ul class="event-box" v-on:drop='eventDrop(event, ntra)' v-on:dragover='eventDragover(event)'>
					<li>
						<span v-if='ntra.event==null'>Drag an event to here</span>
						<span class="badge badge-pill badge-event" v-else-if='ntra.event.type == 0'>
              When 
							<select v-model="ntra.event.args[0]">
									<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
							</select> is clicked, 
						</span>
						<span class="badge badge-pill badge-event" v-else-if='ntra.event.type == 1'>
              When
							<select v-model="ntra.event.args[0]">
									<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
							</select> 
							is used on
							<select v-model="ntra.event.args[1]">
									<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option> ,
							</select> 
						</span>              
						<span class="badge badge-pill badge-event" v-else-if='ntra.event.type == 2'>
              When
							<select v-model="ntra.event.args[0]">
									<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
							</select> is observed, 
						</span>              
						<span class="badge badge-pill badge-event" v-else-if='ntra.event.type == 3'>
              When
							<select v-model="ntra.event.args[0]">
									<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
							</select> 
							is combined with
							<select v-model="ntra.event.args[1]">
									<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
							</select> , 
						</span>
					</li>
				</ul>
				<h6 id="condition-box-title" class="window-title">Condition</h6>
				<ul class="condition-box" v-on:drop='stateDrop(event, ntra)' v-on:dragover='stateDragover(event)'>
					<li v-for='cond in ntra.conditionList' v-on:dblclick='removeCondition(cond, ntra)'>
						<span class="badge badge-pill badge-state">
              if <span v-html='cond.name'></span> is 
              <label class="switch"><input type="checkbox" v-model='cond.value'><span class="slider round"></span></label>
            </span>
					</li>

				 
				</ul>
				<h6 id="reaction-box-title" class="window-title">Reaction</h6>
				<ul class="reaction-box" v-on:drop='reactionDrop(event, ntra)' v-on:dragover='reactionDragover(event)'>
					<li v-for='react in ntra.reactionList' v-on:dblclick='deleteReaction(react, ntra)'>
						<!--span class="badge badge-pill badge-reaction" v-html='react.template'></span-->
						<span class="badge badge-pill badge-reaction" v-if='react.type == 0'>
								Set state 
								<select v-model="react.args[0]">
<!--                        <option selected>win</option>-->
										<option v-for="stat in states" v-html="stat.name" v-bind:value="stat"></option>
								</select> to 
                <label class="switch"><input type="checkbox" v-model='react.args[1]'><span class="slider round"></span></label>
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 1'>
								Go to scene 
								<select v-model="react.args[0]">
										<option v-for="scene in scenes" v-html="scene.name" v-bind:value="scene"></option>
								</select>
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 2'>
								Add 
								<select v-model="react.args[0]">
										<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
								</select> into inventory
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 3'>
								Remove 
								<select v-model="react.args[0]">
										<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
								</select> out of inventory
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 4'>
								Make 
								<select v-model="react.args[0]">
										<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
								</select> visible
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 5'>
								Make 
								<select v-model="react.args[0]">
										<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
								</select> invisible
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 6'>
								Make 
								<select v-model="react.args[0]">
										<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
								</select> interactive
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 7'>
								Make 
								<select v-model="react.args[0]">
										<option v-for="obj in objects" v-html="obj.name" v-bind:value="obj"></option>
								</select> not interactive
						</span>
						
						<span class="badge badge-pill badge-reaction" v-if='react.type == 8'>
								Show dialog
								<input v-model='react.args[0]'/>
						</span>

						<span class="badge badge-pill badge-reaction" v-if='react.type == 9'>
								Play sound
								<select v-model="react.args[0]">
										<option v-for="sound in sounds" v-html="sound.name" v-bind:value="sound"></option>
								</select>
						</span>
					</li>
				</ul>
			</div>
      </div>
      <div id="add-interaction">
  			<!--button type="button"  class="btn btn-outline-success btn-sm" id="add-interaction-button" v-on:click='addInteraction()'> Add Interaction </button-->
  			<a v-on:click='addInteraction()'><img src="./src/add-interaction.svg" class="svg" width="70" height="70"/></a>
			</div>
		</div>

		<div id="first-second-resizer" 
			resizer="vertical-left" 
			resizer-width="6" 
			resizer-left="#first-column" 
			resizer-right="#second-column"
			resizer-max="720">
		</div>
		<div id="second-third-resizer" 
			resizer="vertical-right" 
			resizer-width="6" 
			resizer-left="#second-column" 
			resizer-right="#third-column"
			resizer-max="400">
		</div>

		<div id="third-column">
			
			

			<div id="interaction-library">
				<h6 class="window-title">INTERACTION LIBRARY</h6>
				<div id="event-library"><h6 class="window-title">Event</h6>
					<ul id="event-list" v-if='viewEnabled'>
						<li v-for='em in events'>
							<span class="badge badge-pill badge-event" v-on:dragstart='eventDragstart(event, em.type)' draggable="true" v-html='em.name'></span>
						</li>
					</ul>
				</div>
				<div id="state-library">
				<h6 class="window-title">State</h6>
				<div id="add-state"><button type="button" class="badge badge-pill badge-state-button" id="add-state-button" v-on:click='newState()'>Add</button></div>
					<ul id="state-list" v-if='viewEnabled'>
						<li v-for='state in states' v-on:dblclick='deleteState(state)'>
							<span class="badge badge-pill badge-state" v-on:dragstart='stateDragstart(event, state)' draggable="true">
								<span v-html='state.name'>helllo</span>
								&nbsp;&nbsp;

								<label class="switch"><input type="checkbox" v-model='state.value'><span class="slider round"></span></label>
								<!--<input type="checkbox" v-model='state.value'>-->
							</span>
						</li> 
					</ul>

				</div>
				<div id="reaction-library"><h6 class="window-title">Reaction</h6>
					<ul id="reaction-list" v-if='viewEnabled'>
						<li v-for='rm in reactions'>
							<span class="badge badge-pill badge-reaction" v-on:dragstart='reactionDragstart(event, rm.type)' draggable="true" v-html='rm.name'></span>
						</li>
					</ul>
				</div>
			</div>

			<div id="design-property">
				<h6 class="window-title">PROPERTIES</h6>
				<!-- bind img src -->
				<div v-if='showProperty' class="property-img-bg"> <img class="property-img" v-bind:src="'../../'+bindObj.src"></div>
				<!-- bind info -->
				<div v-if='showProperty' class="property-info">
					<ul>
						<li><span ondblclick="editInPlace(event)" class="editInPlace" v-model='bindObj.name'/>name</span></li>

						<!--<input v-model='bindObj.name'/>-->
						<li>
						<label for="property-input">position </label>
						<div class="property-input">
						x: <input id="pos-x" v-model.number='bindObj.sprite.x'>
						 y:<input id="pos-y" v-model.number='bindObj.sprite.y'>
					 </div>
					 </li>
						<li>
							scale
							<div class="property-input">
								x: <input id="scale-x" v-model.number='bindObj.sprite.scale.x'>
						        y: <input id="scale-y" v-model.number='bindObj.sprite.scale.y'>
					 </div>
				 </li>

						<li>
							
							<!--<input v-model='bindObj.sprite.visible' id ="visible" type="checkbox">-->
							visible
							<label class="switch"><input type="checkbox" v-model='bindObj.sprite.visible' id ="visible" ><span class="slider round"></span></label>
							
							
						</li>
						<li>
							 <!--<input v-model='bindObj.interactive' id="clickable" type="checkbox">-->
						<label for="clickable">interactive</label>
						<label class="switch"><input type="checkbox" v-model='bindObj.interactive' id ="visible" ><span class="slider round"></span></label>
						 
						</li>

						<!-- user properties -->
						<!--li v-for='property in bindObj.properties'>
							<label for="pos-x">{{ property.key }}:</label> 
							<input id="pos-x" v-model='property.value'>
						</li-->

					</ul>

				</div>
			</div>
			<div id="design-property-resizer" 
				resizer="horizontal" 
				resizer-height="6" 
				resizer-top="#interaction-library" 
				resizer-bottom="#design-property"
				resizer-min="350"
				>
			</div>
		</div>


	</div> <!-- end of design view -->
	<script>InitAllViews();</script>

<!--
	<div id="code-view" style="display: none;">

		<div id="code-library">
			
				<h6 class="window-title">CODE LIBRARY</h6>
		</div>
	
		<div id="code-content">

			<div id="code-preview">
				<h6 class="window-title">PREVIEW</h6></div>
	
			<div id="code-editor">
				<h6 class="window-title">CODE EDITOR</h6></div>
	
			<div id="code-editor-resizer" 
				resizer="horizontal" 
				resizer-height="6" 
				resizer-top="#code-preview" 
				resizer-bottom="#code-editor">
			</div>
	
		</div>

		<div id="code-library-resizer" 
			resizer="vertical-left" 
			resizer-width="6" 
			resizer-left="#code-library" 
			resizer-right="#code-content"
			resizer-max="400">
		</div>
		<div id="code-side-resizer" 
			resizer="vertical-right" 
			resizer-width="6" 
			resizer-left="#code-content" 
			resizer-right="#code-side-common"
			resizer-max="400">
		</div>


		<div id="code-side-common">
			
			<div id="code-object-list">
			 
				<h6 class="window-title">OBJECTS IN THE SCENES</h6>
			</div>
			<div id="code-property">

				<h6 class="window-title">PROPERTIES</h6>
			</div>
			<div id="code-property-resizer" 
				resizer="horizontal" 
				resizer-height="6" 
				resizer-top="#code-object-list" 
				resizer-bottom="#code-property">
			</div>
		</div>


	</div>  end of code view -->

		
	
		

		

		


	
	
	<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="http://code.jquery.com/jquery-2.0.3.min.js" data-semver="2.0.3" data-require="jquery"></script>
 
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> 
	-->
</body>
</html>